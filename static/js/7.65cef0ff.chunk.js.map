{"version":3,"sources":["pages/Blog.js"],"names":["Blog","state","dialogOpen","blogPosts","blogAuthors","ready","blogExpanded","componentDidMount","a","listSpaces","config","ethereumAddress","includes","blogSpaceName","getThreadByAddress","blogThread","sort","b","timestamp","i","length","parseThread","setState","j","hasOwnProperty","author","getProfile","profile","handleDialogOpen","handleDialogClose","handleExpandClick","index","unixToDate","Intl","DateTimeFormat","weekday","year","month","day","format","Date","postThread","parsedMessage","fm","message","tags","attributes","split","date","title","description","body","error","console","t","this","props","item","xs","lg","variant","gutterBottom","color","href","startIcon","disabled","onClick","map","in","style","transitionDelay","key","my","avatar","src","image","contentUrl","name","subheader","disableSpacing","postId","timeout","unmountOnExit","dangerouslySetInnerHTML","markdown","options","configShowdown","onClose","aria-labelledby","open","maxWidth","autoFocus","Component","withTranslation"],"mappings":"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","file":"static/js/7.65cef0ff.chunk.js","sourcesContent":["import React, { Component } from \"react\";\r\nimport { withTranslation } from \"react-i18next\";\r\nimport { getThreadByAddress, listSpaces, getProfile } from \"3box/lib/api\";\r\nimport Markdown from \"react-showdown\";\r\nimport fm from \"front-matter\";\r\n//material-ui\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Card from \"@material-ui/core/Card\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport CardContent from \"@material-ui/core/CardContent\";\r\nimport CardActions from \"@material-ui/core/CardActions\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport Zoom from \"@material-ui/core/Zoom\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport Collapse from \"@material-ui/core/Collapse\";\r\nimport CardActionArea from \"@material-ui/core/CardActionArea\";\r\nimport CardHeader from \"@material-ui/core/CardHeader\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\n//icons\r\nimport { OpenInNew, InformationOutline, Message, Share, ChevronDown, Account } from \"mdi-material-ui\";\r\n//custom\r\nimport config from \"../config.json\";\r\nimport configShowdown from \"../style/configShowdown.json\";\r\n\r\nclass Blog extends Component {\r\n  state = {\r\n    dialogOpen: false,\r\n    blogPosts: [],\r\n    blogAuthors: {},\r\n    ready: false,\r\n    blogExpanded: [],\r\n  };\r\n\r\n  componentDidMount = async () => {\r\n    const spaces = await listSpaces(config.ethereumAddress);\r\n    if (spaces.includes(config.blogSpaceName)) {\r\n      let blogPosts = await getThreadByAddress(config.blogThread);\r\n      //sort by date\r\n      blogPosts = blogPosts.sort((a, b) => {\r\n        a = a.timestamp;\r\n        b = b.timestamp;\r\n        return a > b ? -1 : a < b ? 1 : 0;\r\n      });\r\n      //parse thread\r\n      for (var i = 0; i < blogPosts.length; i++) {\r\n        blogPosts[i] = this.parseThread(blogPosts[i]);\r\n      }\r\n      this.setState({ blogPosts });\r\n      this.setState({ ready: true });\r\n      //get authors\r\n      let blogAuthors = {};\r\n      for (var j = 0; j < blogPosts.length; j++) {\r\n        if (!blogAuthors.hasOwnProperty(blogPosts[j].author)) {\r\n          const profile = await getProfile(blogPosts[j].author);\r\n          blogAuthors[blogPosts[j].author] = profile;\r\n        }\r\n      }\r\n      this.setState({ blogAuthors });\r\n    }\r\n  };\r\n\r\n  handleDialogOpen = () => {\r\n    this.setState({ dialogOpen: true });\r\n  };\r\n  handleDialogClose = () => {\r\n    this.setState({ dialogOpen: false });\r\n  };\r\n  handleExpandClick = (index) => () => {\r\n    let blogExpanded = this.state.blogExpanded;\r\n    blogExpanded[index] = blogExpanded[index] ? !blogExpanded[index] : true;\r\n    this.setState({ blogExpanded });\r\n  };\r\n  unixToDate = (timestamp) => {\r\n    return Intl.DateTimeFormat(\"default\", { weekday: \"long\", year: \"numeric\", month: \"long\", day: \"numeric\" }).format(new Date(timestamp * 1000));\r\n  };\r\n  parseThread = (postThread) => {\r\n    try {\r\n      const parsedMessage = fm(postThread.message);\r\n      const tags = parsedMessage.attributes.tags ? parsedMessage.attributes.tags.split(\",\") : [];\r\n      const date = this.unixToDate(postThread.timestamp);\r\n      return {\r\n        title: parsedMessage.attributes.title,\r\n        description: parsedMessage.attributes.description,\r\n        body: parsedMessage.body,\r\n        ...postThread,\r\n        tags,\r\n        date,\r\n      };\r\n    } catch (error) {\r\n      console.error(error);\r\n      return {\r\n        title: \"Error Parsing message\",\r\n        description: \"\",\r\n        body: postThread.message,\r\n        ...postThread,\r\n        author: \"author\",\r\n        tags: [],\r\n        date: \"\",\r\n      };\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { t } = this.props;\r\n    const { ready, blogPosts, blogAuthors, dialogOpen, blogExpanded } = this.state;\r\n    //console.log(blogExpanded);\r\n    return (\r\n      <Grid item xs={12} lg={12}>\r\n        <Typography variant=\"h2\" gutterBottom>\r\n          {t(\"blog.title\")}\r\n        </Typography>\r\n        <Typography variant=\"body2\" gutterBottom>\r\n          {t(\"blog.description\")}\r\n        </Typography>\r\n        <Button variant=\"contained\" color=\"secondary\" href=\"/\" startIcon={<OpenInNew />} disabled>\r\n          {t(\"blog.linkMain\")}\r\n        </Button>\r\n        &nbsp;\r\n        <Button variant=\"contained\" color=\"secondary\" href=\"https://medium.com/@simonbuechi\" startIcon={<OpenInNew />}>\r\n          {t(\"blog.linkMedium\")}\r\n        </Button>\r\n        &nbsp;\r\n        <Button variant=\"contained\" color=\"primary\" onClick={this.handleDialogOpen} startIcon={<InformationOutline />}>\r\n          {t(\"blog.dialogButton\")}\r\n        </Button>\r\n        {!ready ? (\r\n          <Box my={3}>\r\n            <CircularProgress color=\"primary\" />\r\n          </Box>\r\n        ) : (\r\n          blogPosts.map((item, index) => (\r\n            <Zoom in style={{ transitionDelay: 450 + index * 100 + \"ms\" }} key={index}>\r\n              <Box my={2}>\r\n                <Card>\r\n                  <CardActionArea onClick={this.handleExpandClick(index)}>\r\n                    <CardHeader\r\n                      avatar={\r\n                        blogAuthors.hasOwnProperty(item.author) && blogAuthors[item.author].hasOwnProperty(\"image\") ? (\r\n                          <Avatar src={\"https://ipfs.infura.io/ipfs/\" + blogAuthors[item.author].image[0].contentUrl[\"/\"]} />\r\n                        ) : (\r\n                          <Avatar>\r\n                            <Account />\r\n                          </Avatar>\r\n                        )\r\n                      }\r\n                      title={\r\n                        blogAuthors.hasOwnProperty(item.author) && blogAuthors[item.author].hasOwnProperty(\"name\") ? blogAuthors[item.author].name : item.author\r\n                      }\r\n                      subheader={this.unixToDate(item.timestamp)}\r\n                    />\r\n                    <CardContent>\r\n                      <Typography variant=\"h2\">{item.title}</Typography>\r\n                    </CardContent>\r\n                  </CardActionArea>\r\n                  <CardActions disableSpacing>\r\n                    <Tooltip title=\"Read more\">\r\n                      <IconButton onClick={this.handleExpandClick(index)}>\r\n                        <ChevronDown />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Share\">\r\n                      <IconButton>\r\n                        <Share />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Copy full message\">\r\n                      <IconButton>\r\n                        <Message />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Copy ID\">\r\n                      <IconButton>\r\n                        <Share />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title={\"Post ID is \" + item.postId + \", created by \" + item.author}>\r\n                      <IconButton>\r\n                        <InformationOutline />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                  </CardActions>\r\n                  <Collapse in={blogExpanded[index]} timeout=\"auto\" unmountOnExit>\r\n                    <CardContent>\r\n                      <Markdown dangerouslySetInnerHTML markdown={item.body} options={configShowdown} />\r\n                    </CardContent>\r\n                  </Collapse>\r\n                </Card>\r\n              </Box>\r\n            </Zoom>\r\n          ))\r\n        )}\r\n        <Dialog onClose={this.handleDialogClose} aria-labelledby=\"simple-dialog-title\" open={dialogOpen} maxWidth=\"xl\">\r\n          <DialogContent>\r\n            <Typography variant=\"h2\" gutterBottom>\r\n              {t(\"blog.dialogTitle\")}\r\n            </Typography>\r\n            <Typography variant=\"body2\" gutterBottom>\r\n              {t(\"blog.dialogBody1\")}\r\n            </Typography>\r\n            <Typography variant=\"body2\" gutterBottom>\r\n              {t(\"blog.dialogBody2\")}\r\n            </Typography>\r\n            <Typography variant=\"body2\" gutterBottom>\r\n              {t(\"blog.dialogBody3\")}\r\n            </Typography>\r\n            <Typography variant=\"body2\" gutterBottom>\r\n              {t(\"blog.dialogBody4\")}\r\n            </Typography>\r\n            <Button variant=\"contained\" color=\"secondary\" href=\"/\" disabled>\r\n              {t(\"blog.dialogBlogLink\")}\r\n            </Button>\r\n            &nbsp;\r\n            <Button variant=\"outlined\" color=\"primary\" href=\"https://docs.3box.io\">\r\n              {t(\"blog.dialog3BoxLink\")}\r\n            </Button>\r\n            &nbsp;\r\n            <Button variant=\"outlined\" color=\"primary\" href=\"https://orbitdb.org\">\r\n              {t(\"blog.dialogOrbitLink\")}\r\n            </Button>\r\n          </DialogContent>\r\n          <DialogActions>\r\n            <Button onClick={this.handleDialogClose} color=\"secondary\" autoFocus>\r\n              {t(\"base.close\")}\r\n            </Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n      </Grid>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation()(Blog);\r\n"],"sourceRoot":""}